<%- include ('../partials/head') %>
<%- include ('../partials/menu') %>
<%- include ('../partials/message') %>

<main>
  <div class="container">
    <!-- THE REST OF YOUR HTML CODE GOES HERE -->
    <div class="d-flex justify-content-center" style="margin-top: 2%;"id="explore_anywhere">
        <% if(species_param == undefined){%>
            <div class="col-5" style="text-align: right;">
                <a type="button" href="/explore_anywhere?species=dog" class="btn btn-light" style="background-color:rgb(222, 168, 249);">
                    <svg xmlns="http://www.w3.org/2000/svg" height="73" width="100" viewBox="0 0 560 512"><!--!Font Awesome Free 6.5.0 by @fontawesome - 
                        https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M309.6 158.5L332.7 
                        19.8C334.6 8.4 344.5 0 356.1 0c7.5 0 14.5 3.5 19 9.5L392 32h52.1c12.7 0 24.9 5.1 33.9 14.1L496 64h56c13.3 0 24 10.7 24 24v24c0 44.2-35.8 
                        80-80 80H464 448 426.7l-5.1 30.5-112-64zM416 256.1L416 480c0 17.7-14.3 32-32 32H352c-17.7 0-32-14.3-32-32V364.8c-24 12.3-51.2 19.2-80 
                        19.2s-56-6.9-80-19.2V480c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V249.8c-28.8-10.9-51.4-35.3-59.2-66.5L1 167.8c-4.3-17.1 6.1-34.5 
                        23.3-38.8s34.5 6.1 38.8 23.3l3.9 15.5C70.5 182 83.3 192 98 192h30 16H303.8L416 256.1zM464 80a16 16 0 1 0 -32 0 16 16 0 1 0 32 0z"/>
                    </svg>
                    <h4 style="padding-top: 4%;">
                        Dogs
                    </h4>
                </a>
            </div>
        <%} 
        else{%>
            <div class="col-5" style="text-align: right;">
                <a type="button" href="/explore_anywhere?" class="btn btn-light" style="background-color:rgb(222, 168, 249);">
                    <svg xmlns="http://www.w3.org/2000/svg" height="73" width="100" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.0 by @fontawesome - 
                        https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M226.5 92.9c14.3 42.9-.3 
                        86.2-32.6 96.8s-70.1-15.6-84.4-58.5s.3-86.2 32.6-96.8s70.1 15.6 84.4 58.5zM100.4 198.6c18.9 32.4 14.3 70.1-10.2 84.1s-59.7-.9-78.5-33.3S-2.7 
                        179.3 21.8 165.3s59.7 .9 78.5 33.3zM69.2 401.2C121.6 259.9 214.7 224 256 224s134.4 35.9 186.8 177.2c3.6 9.7 5.2 20.1 5.2 30.5v1.6c0 25.8-20.9 
                        46.7-46.7 46.7c-11.5 0-22.9-1.4-34-4.2l-88-22c-15.3-3.8-31.3-3.8-46.6 0l-88 22c-11.1 2.8-22.5 4.2-34 4.2C84.9 480 64 459.1 64 433.3v-1.6c0-10.4 
                        1.6-20.8 5.2-30.5zM421.8 282.7c-24.5-14-29.1-51.7-10.2-84.1s54-47.3 78.5-33.3s29.1 51.7 10.2 84.1s-54 47.3-78.5 33.3zM310.1 189.7c-32.3-10.6-46.9-53.9-32.6-96.8s52.1-69.1 
                        84.4-58.5s46.9 53.9 32.6 96.8s-52.1 69.1-84.4 58.5z"/>
                    </svg>
                    <h4 style="padding-top: 4%;">
                        All Pets
                    </h4>
                </a>
            </div>
        <%}
            if(species_param == "dog" || species_param == undefined){%>
            <div class="col-1"> &nbsp;</div>
            <div class="col-5">
                <a type="button" href="/explore_anywhere?species=cat" class="btn btn-light" style="background-color:rgb(222, 168, 249);">
                    <svg xmlns="http://www.w3.org/2000/svg" height="73" width="100" viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.0 by @fontawesome - 
                        https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M320 192h17.1c22.1 
                        38.3 63.5 64 110.9 64c11 0 21.8-1.4 32-4v4 32V480c0 17.7-14.3 32-32 32s-32-14.3-32-32V339.2L280 448h56c17.7 0 32 14.3 32 32s-14.3 
                        32-32 32H192c-53 0-96-43-96-96V192.5c0-16.1-12-29.8-28-31.8l-7.9-1c-17.5-2.2-30-18.2-27.8-35.7s18.2-30 35.7-27.8l7.9 1c48 6 84.1 
                        46.8 84.1 95.3v85.3c34.4-51.7 93.2-85.8 160-85.8zm160 26.5v0c-10 3.5-20.8 5.5-32 5.5c-28.4 0-54-12.4-71.6-32h0c-3.7-4.1-7-8.5-9.9-13.2C357.3 
                        164 352 146.6 352 128v0V32 12 10.7C352 4.8 356.7 .1 362.6 0h.2c3.3 0 6.4 1.6 8.4 4.2l0 .1L384 21.3l27.2 36.3L416 64h64l4.8-6.4L512 21.3 524.8 
                        4.3l0-.1c2-2.6 5.1-4.2 8.4-4.2h.2C539.3 .1 544 4.8 544 10.7V12 32v96c0 17.3-4.6 33.6-12.6 47.6c-11.3 19.8-29.6 35.2-51.4 42.9zM432 128a16 16 0 
                        1 0 -32 0 16 16 0 1 0 32 0zm48 16a16 16 0 1 0 0-32 16 16 0 1 0 0 32z"/>
                    </svg>
                    <h4 style="padding-top: 4%;">
                        Cats
                    </h4>
                </a>
            </div>
        <%}
            else if(species_param == "cat"){%>
            <div class="col-1"> &nbsp;</div>
            <div class="col-5">
                <a type="button" href="/explore_anywhere?species=dog" class="btn btn-light" style="background-color:rgb(222, 168, 249);">
                    <svg xmlns="http://www.w3.org/2000/svg" height="73" width="100" viewBox="0 0 560 512"><!--!Font Awesome Free 6.5.0 by @fontawesome - 
                        https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M309.6 158.5L332.7 
                        19.8C334.6 8.4 344.5 0 356.1 0c7.5 0 14.5 3.5 19 9.5L392 32h52.1c12.7 0 24.9 5.1 33.9 14.1L496 64h56c13.3 0 24 10.7 24 24v24c0 44.2-35.8 
                        80-80 80H464 448 426.7l-5.1 30.5-112-64zM416 256.1L416 480c0 17.7-14.3 32-32 32H352c-17.7 0-32-14.3-32-32V364.8c-24 12.3-51.2 19.2-80 
                        19.2s-56-6.9-80-19.2V480c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V249.8c-28.8-10.9-51.4-35.3-59.2-66.5L1 167.8c-4.3-17.1 6.1-34.5 
                        23.3-38.8s34.5 6.1 38.8 23.3l3.9 15.5C70.5 182 83.3 192 98 192h30 16H303.8L416 256.1zM464 80a16 16 0 1 0 -32 0 16 16 0 1 0 32 0z"/>
                    </svg>
                    <h4 style="padding-top: 4%;">
                        Dogs
                    </h4>
                </a>
            </div>
        <%}%>
    </div>
    <div class="d-flex justify-content-center" style="margin-top: 2%;"id="explore_anywhere">
        <div class="col-2" style="text-align: right;">
            <%if(values.length > 1){ %>
                <p>Filters:</p>
            <%} %>
        </div>
        <div class="col-10" style="padding-left: 2%;">
            <%
            values.shift();
            keys.shift();
            values = values.flat();
            keys = keys.flat();
            for (let i = 0; i < values.length; i++) {
                var newUrl = fullUrl.replace("&" + keys[i] + "=" + values[i].replaceAll(" ", "%20"),"");
                %>
                <div class="btn-group" role="group" aria-label="Basic example">
                    <a class="btn btn-primary" style="--bs-btn-font-size: .65rem;"> 
                        <% displayValue = values[i];
                        if(values[i] == "baby" && species_param == "dog"){
                            displayValue = "Puppy";
                        }
                        else if(values[i] == "baby" && species_param == "cat"){
                            displayValue = "Kitten";
                        }%>
                        <%= displayValue %>
                    </a>
                    <a class="btn btn-primary" style="--bs-btn-font-size: .65rem;" href="<%= newUrl %>">X</a>
                  </div>
                
            <% } %>
        </div>
    </div>

    <div class="d-flex justify-content-center" style="margin-bottom: 5%;"id="explore_anywhere">
        
        <%if(filter.length != 0){%>
            <div class="col-2" style="padding-top: 3%;">
                <%   filter.forEach(filter =>{%>
                    <div class="row" style="padding-top: 10%;">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <%=filter[0]%>
                            </button>
                            <ul class="dropdown-menu" style = "max-height: 200px;overflow-y: scroll;">
                                <% filter[2].forEach(parameter =>{
                                    urlParam = parameter;
                                    if(parameter == "Puppy" || parameter == "Kitten"){urlParam = "baby";}%>
                            <li><a class="dropdown-item" href="<%= fullUrl + `&` + filter[1] + `=` + urlParam %>"><%=parameter%></a></li>
                                <%});%>
                            </ul>
                        </div>
                    </div>
                <%});%>
            </div>
            <%}%>
            <%if(filter.length == 0){%>
            <div class="col-12" >
            <%}
                else{%>
            <div class="col-10">
            <%}%>
                <div class="row">
                    <%results.data.animals.forEach(pet =>{
                        if(pet.primary_photo_cropped != null){%>
                    <div class="col" style="padding-top: 5%; padding-left: 2.5%;">
                        <div class="card" style="width: 16rem; text-align: center;" id="hobby-card-3">
                            <img src="<%=pet.primary_photo_cropped.small%>" class="card-img-top" alt="..." width="275" height="183">
                            <div class="card-img-overlay" style = "text-align: right; height: 11.5rem;">
                                <a type="button" class="btn btn-light rounded-circle bg-opacity-10 favorite-button" style="color: white; background-color: grey;" data-pet-id="<%= pet.id %>" data-favorite="<%= pet.isFavorite %>" onclick="addToFavorites('<%= pet.id %>', '<%= username %>', '<%= pet.name %>', '<%= pet.age %>', '<%= pet.gender %>', '<%= pet.description %>', '<%= pet.primary_photo_cropped.small %>')">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                                    </svg>
                                </a>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title"><%=pet.name.split(" ")[0]%></h5>
                                <p><%=pet.age%> | <%=pet.breeds.primary%></p>
                                <% var dist = "";
                                    if(pet.distance < 1){
                                        dist = "Less Than 1 Mile Away";
                                    } 
                                    else{ 
                                        dist = Math.round(pet.distance) + " Miles Away";
                                    }
                                %>
                                <p><%=dist%></p>
                                <a type="btn btn-primary" href="/petpage?pet_id=<%=pet.id%>" class="btn btn-primary">More Info</a>
                            </div>
                        </div>
                    </div>
                    <% }
                });%>
                </div>
            </div>
      </div>
  </div>
</main>
<script>
    async function addToFavorites(petID, username, name, age, gender, petphoto) {
      try {
        const response = await fetch('/add_favorite_anywhere', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ username, petID: parseInt(petID), name, age, gender, petphoto }),
        });

        const data = await response.json();
        
//should we redirect to favorites after successfully adding to favorites?
        console.log('Response:', data);
      } catch (error) {
        console.error('Error:', error);
      }
    }
  </script>
<%- include ('../partials/footer') %>